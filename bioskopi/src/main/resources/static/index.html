<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Bioskopi - pocetna</title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

	
	<script>
		function popuniBioskope(bioskopi) {
	
			if (bioskopi.length == 0) {
				$('#bioskopi').append(
					'<li style="font-style:italic;color:grey;">nema rezulata</li>'
					);
				return;
			}
			
			
			bioskopi.forEach(function (b, i) {
				
				ocena = "";
				for (i = 0; i < b.averageRating; i++) { 
				    ocena += "$";
				}
				
				$('#bioskopi').append(
					'<li>' +
					'<span style="float: right;">' + ocena + '</span></span>' +
					'<span>' + b.name + '</span><br>' + 
					'<span><span style="color:gray; float: left;">' + b.address + '</span>' + 
					'<a href="theater-'+ (window.currentUser == null ? 'basic' : 'full') +'.html?id=' + b.id + '">' +
					'<span class="link-spanner"></span>' +
					'</a>' +
					((window.currentUser != null && window.currentUser.role=='ADMIN_THEATER') ? '<a style="float:right;" href="theater-management.html?id=' + b.id + '">izmeni</a></li>' : '')
					);
			});
		}
	</script>
	<script>
		function popuniPozorista(pozorista) {
	
			if (pozorista.length == 0) {
				$('#pozorista').append(
					'<li style="font-style:italic;color:grey;">nema rezulata</li>'
					);
				return;
			}
			
			
			pozorista.forEach(function (b, i) {
				
				ocena = "";
				for (i = 0; i < b.averageRating; i++) { 
				    ocena += "$";
				}
				
				$('#pozorista').append(
					'<li>' +
					'<span>' + b.name + '</span><br>' + 
					'<span><span style="color:gray; float: left;">' + b.address + '</span>' + 
					'<span style="float: right;">' + ocena + '</span></span>' +
					'<a href="theater-basic.html?id=' + b.id + '">' +
					'<span class="link-spanner"></span>' +
					'</a>' +
					((window.currentUser != null && window.currentUser.role=='ADMIN_THEATER') ? '<a style="float:right;" href="theater-management.html?id=' + b.id + '">izmeni</a></li>' : '')
					);
			});
		}
	</script>
	
    <script>
	    function traziBioskope() {
	    	
			//ocisti <ul> element
			$('#bioskopi').empty();
	    	
	    	search_param = $('#bioskopi-search-box').val();
	    	
	    	if (search_param == "") {
	    		//kada se ocisti search box, refersuje view bioskopa
	    		showAllMovieTheaters();
	    		return;
	    	}
	    	
	   		$.ajax({
	   			url: "public/get_movie_theater_by_name/" + search_param,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				bioskopi = page.content
	
	   				popuniBioskope(bioskopi)
	   			}
	   		});
	    }
    </script>
    
    <script>
	    function traziPozorista() {
	    	
			//ocisti <ul> element
			$('#pozorista').empty();
	    	
	    	search_param = $('#pozorista-search-box').val();
	    	
	    	if (search_param == "") {
	    		//kada se ocisti search box, refersuje view bioskopa
	    		showAllPlayTheaters();
	    		return;
	    	}
	    	
	   		$.ajax({
	   			url: "public/get_play_theater_by_name/" + search_param,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				pozorista = page.content
	
	   				popuniPozorista(pozorista)
	   			}
	   		});
	    }
    </script>
	
	<!-- poziva se pri loadu strane i na prazan search -->  
	<script>
		function showAllMovieTheaters() {
			$.ajax({
				url: "public/get_all_movie_theaters",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					page = JSON.parse(data.responseText);
					bioskopi = page.content
					
					popuniBioskope(bioskopi)
				}
			});
		}
	</script>   
 	<script>
		function showAllPlayTheaters() {
			$.ajax({
				url: "public/get_all_play_theaters",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					page = JSON.parse(data.responseText);
					pozorista = page.content
					
					popuniPozorista(pozorista)
				}
			});
		}
	</script>
	  
	<script>
		$(document).ready(function(){
			
			$.ajax({
				url: "public/get_current_user",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					
					//pripremi trenutno ulogovanog usera, da bude dostupan svima na stranici
					var user;
					if (data.responseText == "")
						//nista, nije ulogovan
						user = null;
					else
						user = JSON.parse(data.responseText);
					
					window.currentUser = user;	//cuvamo ga globalno, da ove funckcije sto treba da prikazu sve bioskope
												//mogu malo da koriguju prikaz za ulogovane korisnike
					//to je to
					
					
					
					
					
					if (window.currentUser != null) {
						//ako je ulogovan
						
						$('#reg-log-bar').hide();
					
						if (window.currentUser.role == "ADMIN_THEATER") {
							//huh...nista posebno
						}
						
					} else {
						//ako nije ulogovan
						
						$('#izloguj-se-a').hide();
					}
					
												
					showAllMovieTheaters();
					showAllPlayTheaters();
				}
			});
			
		})
	</script>
	
	
	
	<style>
		a {color:#A16073;}
		a:HOVER {color:#A16073;}
	
		@font-face {
		    font-family: LoveloBold;
		   	src: url('fonts/Lovelo Black.otf')
		}
	
		/*header u vrhu stranice*/
		.top-header {
            background: white;
            min-height: 100px;
            margin: 20px 30px -5px 30px;
            text-align: center;
            
		}
		
		.top-header .title {
			color : #555;
            font-size: 64px;
		}
		.top-header .subtitle {
			color : #555;
            font-size: 16px;
		}
		
		/*centralni sadrzaj stranice*/
		.content {
			margin: 25px 30px 50px 30px;
		}
		
		.bioskopi-widget {
		
		}
		
		.bioskopi-widget .header {
			background : #A16073;
			color : white;
			padding : 5px;
			height: 35px;
		}
		
		.bioskopi-widget > ul {
			margin-top : 0px;
			background : white;
			list-style : none;
			padding-left : 0px;
		}
		
		.bioskopi-widget > ul > li {
			height : 45px; /*zbog floatova*/
			padding : 5px;
			transition: background 0.15s linear;
			position:relative; /*zbog link-spannera*/
		}
		
		.bioskopi-widget > ul > li:HOVER {
			background : #E5FAE1;
			
		}
		
		.link-spanner{
			position:absolute; 
			width:80%;
			height:100%;
			top:0;
			left: 0;
			z-index: 1;
		
		  /* edit: fixes overlap error in IE7/8, 
		     make sure you have an empty gif 
		  background-image: url('empty.gif');*/
		}
		
		.search-button {
			border: 0;
			color: #A16073;
			box-shadow: none;
			border-radius: 0px;
			padding : 2px 5px;
			background: white;
			transition: background 0.1s linear;
		}
		.search-button:HOVER {
			background: #ddd;
		}
		
		/*onaj bar sa 'uloguj se' i 'registruj se'*/
		.reg-log-bar > div {
			width: 40%;
  			margin: 0 auto;
			background: #eee;
		}
		.button-card {
			padding: 15px;
		}
		.button-card > span {
			color: grey;
		}
		.button-card > a {
			border: 0;
			color: white;
			padding : 15px 15px;
			background: #A16073;
			display: block;
  			text-decoration: none;
  			transition: background 0.1s linear;
		}
		.button-card > a:HOVER {
			background: #aaa;
		}
		
	</style>
					
</head>
<body style='background:#e1f7d5;'>
	<div class='row top-header'>
		<div class='col-sm-12'>
			<a style='float:right; margin-top:5px;' href='logout' id='izloguj-se-a'>Izloguj se</a>
			<div class='title'>Bioskopi i pozorista</div>
			<div class='subtitle'>Dobrodosli...lorem ipsumasnf ajnsfjnasjnfjansjfnakdsn</div>
		</div>
	</div>
	
	
	<div class='content'>
	
		<div class = 'row' id='reg-log-bar' style='background:white; margin-bottom:20px; margin-left:0px; margin-right:0px;'>
			<div style='width: 50%; margin-left:auto; margin-right:auto'>
				<div class='col-sm-6 button-card' >
					<span>Imas nalog?</span>
					<br>
					<a href='login.html'>Prijavi se</a>
				</div>
				<div class='col-sm-6 button-card '>
					<span>Jos nemas nalog?</span>
					<br>
					<a href='register.html'>Registruj se</a>
				</div>
			</div>
		</div>
	
		<div class='row'>
			<div class='col-sm-6 bioskopi-widget'>
				<div class='header'>
					Bioskopi
					<button class='search-button' data-toggle='collapse' data-target='#b-search' style='float:right;'>Pretraga</button>
				</div>
				
				<div id='b-search' class='collapse' style='padding:5px;text-align:right;'>
					<input id='bioskopi-search-box' type='text' placeholder="Trazi bioskope..." oninput="traziBioskope()">
				</div>
				<ul id='bioskopi'></ul>
			</div>
			<div class='col-sm-6 bioskopi-widget'>
				<div class='header'>
					Pozorista
					<button class='search-button' data-toggle='collapse' data-target='#p-search' style='float:right;'>Pretraga</button>
				</div>
				
				<div id='p-search' class='collapse' style='padding:5px;text-align:right;'>
					<input id='pozorista-search-box' type='text' placeholder="Trazi pozorista..." oninput="traziPozorista()">
				</div>
				<ul id='pozorista'></ul>
			</div>
		</div>
		
		
	</div> <!-- content -->
	
</body>
</html>