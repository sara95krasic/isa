<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Bioskopi - pocetna</title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/fanzone.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

	
	<script>
		function popuniBioskope(bioskopi) {
	
			if (bioskopi.length == 0) {
				$('#bioskopi').append(
					'<li style="font-style:italic;color:grey;">nema rezulata</li>'
					);
				return;
			}
			
			
			bioskopi.forEach(function (b, i) {
				
				ocena = "";
				for (i = 0; i < b.averageRating; i++) { 
				    ocena += "&#x2605;";
				}
				
				$('#bioskopi').append(
					'<li>' +
					'<span style="float: right;">' + ocena + '</span></span>' +
					'<span>' + b.name + '</span><br>' + 
					'<span><span style="color:gray; float: left; margin-right:5px;">' + b.address + '</span><span id="distance-span-'+b.id+'" style="color:white;background:#c18093; padding:2px 5px;">...</span>' + 
					'<a href="theater-'+ (window.currentUser == null ? 'basic' : 'full') +'.html?id=' + b.id + '">' +
					'<span class="link-spanner"></span>' +
					'</a>' +
					((window.currentUser != null && window.currentUser.role=='ADMIN_THEATER') ? '<a style="float:right;" href="theater-management.html?id=' + b.id + '">izmeni</a></li>' : '')
				);
				
				setDistance(b.id, b.address);
			});
		}
	</script>
	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script>
	
		function deg2rad (angle) {
		  return angle * 0.017453292519943295 // (angle / 180) * Math.PI;
		}
		
		function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
	        const R = 6371; // Radius of the earth in km
	        const dLat = this.deg2rad(lat2 - lat1);  // deg2rad below
	        const dLon = this.deg2rad(lon2 - lon1);
	        const a =
	            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
	            Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) *
	            Math.sin(dLon / 2) * Math.sin(dLon / 2);
	        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
	        const d = R * c; // Distance in km
	        return d;
	    }
	
		function setDistance(id, address) {
			
			var ret;
			
			var geocoder = new google.maps.Geocoder();
			//var address = "Bulevar Mihajla Pupina 3, Novi Sad 21000"; //uncomment this shit

			geocoder.geocode(
				{ 'address': address},
				function(results, status) {

					if (status == google.maps.GeocoderStatus.OK) {
						var theater_latitude = results[0].geometry.location.lat();
						var theater_longitude = results[0].geometry.location.lng();
						//alert(latitude);
						
						//***
						
				        navigator.geolocation.getCurrentPosition((position) => {
				            this.userPositionLatitude = position.coords.latitude;
				            this.userPositionLongitude = position.coords.longitude;
				
			                if (theater_latitude !== null && theater_longitude != null) {
			                    var d = this.getDistanceFromLatLonInKm(theater_latitude, theater_longitude,
			                        this.userPositionLatitude, this.userPositionLongitude);
			                    d = d.toFixed(2);
			                    $('#distance-span-'+id).text(String(d) + " km");
			                }
				        });
						
						//***
					} 
				}
			);
			
		}
	</script>
	
	<script>
		function popuniPozorista(pozorista) {
	
			if (pozorista.length == 0) {
				$('#pozorista').append(
					'<li style="font-style:italic;color:grey;">nema rezulata</li>'
					);
				return;
			}
			
			
			pozorista.forEach(function (b, i) {
				
				ocena = "";
				for (i = 0; i < b.averageRating; i++) { 
				    ocena += "&#x2605;";
				}
				
				$('#pozorista').append(
					'<li>' +
					'<span>' + b.name + '</span><br>' + 
					'<span><span style="color:gray; float: left; margin-right:5px;">' + b.address + '</span><span id="distance-span-'+b.id+'" style="color:white;background:#c18093; padding:2px 5px;">...</span>' + 
					'<span style="float: right;">' + ocena + '</span></span>' +
					'<a href="theater-'+ (window.currentUser == null ? 'basic' : 'full') +'.html?id=' + b.id + '">' +
					'<span class="link-spanner"></span>' +
					'</a>' +
					((window.currentUser != null && window.currentUser.role=='ADMIN_THEATER') ? '<a style="float:right;" href="theater-management.html?id=' + b.id + '">izmeni</a></li>' : '')
				);

				setDistance(b.id, b.address);
			});
		}
	</script>
	
    <script>
	    function traziBioskope() {
	    	
			//ocisti <ul> element
			$('#bioskopi').empty();
	    	
	    	search_param = $('#bioskopi-search-box').val();
	    	
	    	if (search_param == "") {
	    		//kada se ocisti search box, refersuje view bioskopa
	    		showAllMovieTheaters();
	    		return;
	    	}
	    	
	   		$.ajax({
	   			url: "public/get_movie_theater_by_name/" + search_param,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				bioskopi = page.content
	
	   				popuniBioskope(bioskopi)
	   			}
	   		});
	    }
    </script>
    
    <script>
	    function traziPozorista() {
	    	
			//ocisti <ul> element
			$('#pozorista').empty();
	    	
	    	search_param = $('#pozorista-search-box').val();
	    	
	    	if (search_param == "") {
	    		//kada se ocisti search box, refersuje view bioskopa
	    		showAllPlayTheaters();
	    		return;
	    	}
	    	
	   		$.ajax({
	   			url: "public/get_play_theater_by_name/" + search_param,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				pozorista = page.content
	
	   				popuniPozorista(pozorista)
	   			}
	   		});
	    }
    </script>
	
	<!-- poziva se pri loadu strane i na prazan search -->  
	<script>
		function showAllMovieTheaters() {
			$.ajax({
				url: "public/get_all_movie_theaters",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					page = JSON.parse(data.responseText);
					bioskopi = page.content
					
					popuniBioskope(bioskopi)
				}
			});
		}
	</script>   
 	<script>
		function showAllPlayTheaters() {
			$.ajax({
				url: "public/get_all_play_theaters",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					page = JSON.parse(data.responseText);
					pozorista = page.content
					
					popuniPozorista(pozorista)
				}
			});
		}
	</script>
	  
	<script>
		$(document).ready(function(){
			
			$.ajax({
				url: "public/get_current_user",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					
					//pripremi trenutno ulogovanog usera, da bude dostupan svima na stranici
					var user;
					if (data.responseText == "")
						//nista, nije ulogovan
						user = null;
					else
						user = JSON.parse(data.responseText);
					
					window.currentUser = user;	//cuvamo ga globalno, da ove funckcije sto treba da prikazu sve bioskope
												//mogu malo da koriguju prikaz za ulogovane korisnike
					//to je to
					
					
					
					
					
					if (window.currentUser != null) {
						//ako je ulogovan
						$('#rezPrikaz').append(
								'<div class="header">Moje rezervacije</div >'+
								'<table class="table " style="color:grey;">'+
			                    	'<thead>'+
									  '<tr>'+
									     '<th>Datum</th>'+
									     '<th>Vreme</th>'+
									     '<th>Event name</th>'+
									     '<th>Details</th>'+
									     '<th>Cancel</th>'+
									  '</tr>'+
									 '</thead>'+
			                        '<tbody >'+                                    
			                           
			                        '</tbody>'+ 
			                    '</table>'		
						);
						$('#reg-log-bar').hide();
						$('#nav-item').append(
							'<a  style="font-size:18px; margin-left:10px;  margin-top:5px;" href="fanzone.html" onclick="props()" >Fan zona</a>' +		
							(window.currentUser.role == "ADMIN_SYS" ? '<a style="margin-left:18px;  font-size:18px; margin-top:5px;" href="sys-admin-panel.html">Administratorski panel</a>' : '') + 
							'<a style="margin-left:18px; font-size:18px;  margin-top:5px;" href="profile.html">Profil korisnika: '+  window.currentUser.name + '</a>' +
							'<a style="margin-left:940px;  font-size:18px; margin-top:5px;" href="logout"> Izloguj se </a>' 
							
						);
					
						if (window.currentUser.role == "ADMIN_THEATER") {
							//huh...nista posebno
						}
						
						
					} else {
						//ako nije ulogovan
						$('#nav-item').hide();
						//$('#izloguj-se-a').hide();
						$('rezPrikaz').hide();
					}
					
												
					showAllMovieTheaters();
					showAllPlayTheaters();
				}
			});
			
		})
	</script>
	
	
	
	<style>
		a {color:#A16073;}
		a:HOVER {color:#A16073;}
	
		@font-face {
		    font-family: LoveloBold;
		   	src: url('fonts/Lovelo Black.otf')
		}
	
		/*header u vrhu stranice*/
		.top-header {
            background: white;
            min-height: 100px;
            margin: 20px 30px -5px 30px;
            text-align: center;
            
		}
		
		.top-header .title {
			color : #555;
            font-size: 64px;
		}
		.top-header .subtitle {
			color : #555;
            font-size: 16px;
		}
		
		/*centralni sadrzaj stranice*/
		.content {
			margin: 15px 30px 50px 30px;
		}
		
		.bioskopi-widget {
		
		}
		
		.bioskopi-widget .header {
			background : #A16073;
			color : white;
			padding : 5px;
			height: 35px;
		}
		
		.bioskopi-widget > ul {
			margin-top : 0px;
			background : white;
			list-style : none;
			padding-left : 0px;
		}
		
		.bioskopi-widget > ul > li {
			height : 50px; /*zbog floatova*/
			padding : 5px;
			transition: background 0.15s linear;
			position:relative; /*zbog link-spannera*/
		}
		
		.bioskopi-widget > ul > li:HOVER {
			background : #E5FAE1;
			
		}
		
		.link-spanner{
			position:absolute; 
			width:80%;
			height:100%;
			top:0;
			left: 0;
			z-index: 1;
		
		  /* edit: fixes overlap error in IE7/8, 
		     make sure you have an empty gif 
		  background-image: url('empty.gif');*/
		}
		
		.search-button {
			border: 0;
			color: #A16073;
			box-shadow: none;
			border-radius: 0px;
			padding : 2px 5px;
			background: white;
			transition: background 0.1s linear;
		}
		.search-button:HOVER {
			background: #ddd;
		}
		
		/*onaj bar sa 'uloguj se' i 'registruj se'*/
		.reg-log-bar > div {
			width: 40%;
  			margin: 0 auto;
			background: #eee;
		}
		.button-card {
			padding: 15px;
		}
		.button-card > span {
			color: grey;
		}
		.button-card > a {
			border: 0;
			color: white;
			padding : 15px 15px;
			background: #A16073;
			display: block;
  			text-decoration: none;
  			transition: background 0.1s linear;
		}
		.button-card > a:HOVER {
			background: #aaa;
			text-decoration: none;
		}
		
		#nav-item {
			min-height: 30px;
		}
		
		.nav-item-c > a:HOVER {
			background: #ddd;
			text-decoration: none;
		}
		
		
	</style>
					
</head>
<body style='background:#e1f7d5;'>
	<div class='row top-header'>
		<div class='col-sm-12'>
			<div class='title'>Bioskopi i pozorista</div>
			<div class='subtitle'>Dobrodosli!</div>
		</div>
	</div>
	
	<div id='nav-item' class='nav-item-c' style='background:white; margin-top:10px; margin-left:30px;  margin-right:30px;' >
		<!-- ulogovaan -->
		<!--<a href='logout' style='margin-left:600px; font-size:18px; '>  Profil korisnika + window.currentUser.name </a>
		<a  href='logout'>  Izloguj se  </a> -->
	</div>
	
	
	<div class='content'>
	
		<div class = 'row' id='reg-log-bar' style='background:white; margin-bottom:20px; margin-top:25px; margin-left:0px; margin-right:0px;'>
			<div style='width: 50%; margin-left:auto; margin-right:auto'>
				<div class='col-sm-6 button-card' >
					<span>Imas nalog?</span>
					<br>
					<a href='login.html'>Prijavi se</a>
				</div>
				<div class='col-sm-6 button-card '>
					<span>Jos nemas nalog?</span>
					<br>
					<a href='registration.html'>Registruj se</a>
				</div>
			</div>
		</div>
	
		<div class='row'>
			<div class='col-sm-6 bioskopi-widget'>
				<div class='header'>
					Bioskopi
					<button class='search-button' data-toggle='collapse' data-target='#b-search' style='float:right;'>Pretraga</button>
				</div>
				
				<div id='b-search' class='collapse' style='padding:5px;text-align:right;'>
					<input id='bioskopi-search-box' type='text' placeholder="Trazi bioskope..." oninput="traziBioskope()">
				</div>
				<ul id='bioskopi'></ul>
			</div>
			<div class='col-sm-6 bioskopi-widget'>
				<div class='header'>
					Pozorista
					<button class='search-button' data-toggle='collapse' data-target='#p-search' style='float:right;'>Pretraga</button>
				</div>
				
				<div id='p-search' class='collapse' style='padding:5px;text-align:right;'>
					<input id='pozorista-search-box' type='text' placeholder="Trazi pozorista..." oninput="traziPozorista()">
				</div>
				<ul id='pozorista'></ul>
			</div>
			
			<div class='col-sm-6 bioskopi-widget'  id='rezPrikaz'>
			<!--	<div class='header'>Moje rezervacije</div >
					<table class="table " style="color:grey;">
                    	<thead>
						  <tr>
						     <th>Datum</th>
						     <th>Vreme</th>
						     <th>Event name</th>
						     <th>Details</th>
						     <th>Cancel</th>
						  </tr>
						 </thead>
                        <tbody id='rezervacije'>                                    
                           
                        </tbody> 
                    </table>
				
				</div> -->
			
			
		</div>
		
		
	</div> <!-- content -->
	
</body>
</html>