<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Bioskopi - Bioskop</title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="js/helpers.js"></script>

	<script>
		function setProjekcija(value) {
			$("#projekcije-select option[value='"+value+"']").prop('selected', true);
		}
	</script>

	<script>
		function dodajTerminProjekcije() {
			var projectionDate = getFormData($('#novi-termin-forma'));

			if (projectionDate.date.length == 0 || projectionDate.time.length == 0) {
				alert('Datum/vreme moraju biti navedeni!');
				return;
			}
			if (projectionDate.price == null) {
				alert('Cena mora biti navedena!');
				return;
			}

			var theater_id = getUrlParameter('id');
			var hall_label = projectionDate.hall_label;
			var projection_id = projectionDate.projection_id;
			delete projectionDate.projection_id;
			delete projectionDate.hall_label;
			
			var projectionDateJSON = JSON.stringify(projectionDate);
			$.ajax({
	   			url: "add_new_projection_date/" + theater_id + "/" + hall_label + "/" + projection_id,
	   			type:"POST",
	   			data: projectionDateJSON,
				contentType:"application/json",
	   			dataType:"json",
	   			complete: function(data) {
	   				var s = JSON.parse(data.responseText);
	   				
	   				if (s == null || s == 'false') {
	   					alert('Greska!');
	   				} else {
	   					alert('Dodat termin projekcije!');
	   					$('#dodaj-projekciju-modal').modal('hide');
	   				}
	   			}
			});
		}
	</script>
	
	<script>
		function dodajProjekciju() {
			var projection = getFormData($('#nova-projekcija-forma'));

			if (projection.title.trim().length == 0) {
				alert('Naziv mora biti naveden!');
				return;
			}
			
			var actors = projection.actors.split(',');
			for (i in actors) {
				actors[i] = actors[i].trim();
			}
			projection.actors = actors;

			var projectionJSON = JSON.stringify(projection);
			$.ajax({
	   			url: "add_new_projection",
	   			type:"POST",
	   			data: projectionJSON,
				contentType:"application/json",
	   			dataType:"json",
	   			complete: function(data) {
	   				var s = JSON.parse(data.responseText);
	   				
	   				if (s == null || s == 'false') {
	   					alert('Greska!');
	   				} else {
	   					alert('Dodata projekcija!');
	   					$('#dodaj-projekciju-modal').modal('hide');
	   				}
	   			}
			});
		}
	</script>

	<script>
		function showAllProjections() {
			
			$('#repertoar').empty();
			
			theater_id = getUrlParameter('id');
			
			$.ajax({
	   			url: "get_projections_for_theater/" + theater_id,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				projections = page.content;
	   				
	   				if (projections == null || projections.length == 0) {
	   					return;
	   				}
	   				
	   				projections.forEach(
	   					function (p, i) {
	   						var s = 
	   								"<li style='border-bottom:1px solid #c18093; padding:10px; background:white; min-height:90px;'> " +
										"<img src='' width='50' height='70' style='float:left; margin-right: 10px;'/>  " +
										"<div > " +
											"<div style='width:50%; float:left; vertical-align: top;'> " +
												"<div style='font-weight: bold;'>"+p.title+"</div> " +
												"<div>"+p.runtime+" min.</div> " +
											"</div> " +
											"<div style='width:40%; margin-left:auto; text-align:right;'> ";
							
							$.ajax({
					   			url: "get_projectiondates_for_theater_for_projection/" + theater_id + "/" + p.id,
					   			type:"GET",
					   			dataType:"json",
					   			complete: function(data) {
					   				page = JSON.parse(data.responseText);
					   				projectionDates = page.content;
							
					   				if (projectionDates == null || projectionDates.length == 0)
					   					return;
					   				
					   				projectionDates.forEach(
				   						function (pd, ii) {
 				   							s += "<div style='display: inline-block; background:#A16073; padding:5px 5px; text-align: center; margin-bottom:4px;' > " +
											"<div style='color:black; background:#e1f7d5; padding: 2px 5px;'>"+pd.date+"</div> " +
											"<div style='color:white'>sala "+pd.hallLabel+"</div> " +
													"<div style='color:white'>"+pd.time+"</div> " +
													"<div style='color:white; font-weight: bold;'>"+pd.price+" din</div> " +
												"</div> ";
				   						}
			   						)
									s +=		
													"<button class='flat-button' style='display: inline-block; padding:5px 5px; text-align: center; margin-bottom:4px;'  data-toggle='modal' data-target='#dodaj-termin-projekcije-modal' onclick='setProjekcija("+p.id+")'> " +
														"Dodaj termin" +
													"</button> ";
												"</div> " +
											"</div> " +
										"</li>"
	   								$('#repertoar').append(s);
	   							}
							});//ajax
	   					}//function(p,i)
	   				);//projections.forEach
	   			}
			});//ajax
		}
	</script>

	<script>
		function popuniIzborProjekcijaUModalu() {
			$.ajax({
	   			url: "get_all_projections",
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				projections = page.content;
	   				
	   				if (projections == null || projections.length == 0) {
	   					return;
	   				}
	   				projections.forEach(function(p, i) {
	   					$('#projekcije-select').append("<option value="+p.id+">"+p.title+"</option>");
	   				});
   				}
			});
		}
	</script>
	<script>
		function popuniIzborSalaUModalu() {
			var theater_id = getUrlParameter('id');
			$.ajax({
	   			url: "get_all_hall_labels_for_theater/" + theater_id,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				page = JSON.parse(data.responseText);
	   				halls = page.content;
	   				
	   				if (halls == null || halls.length == 0) {
	   					return;
	   				}
	   				halls.forEach(function(h, i) {
	   					$('#sale-select').append("<option value="+h+">"+h+"</option>");
	   				});
   				}
			});
		}
	</script>

	<script>
		$(document).ready(function(){
			

			var theater_id = getUrlParameter('id');
		
			if (theater_id == "") {
				return;
			}
		
			$.ajax({
	   			url: "get_theater_by_id/" + theater_id,
	   			type:"GET",
	   			dataType:"json",
	   			complete: function(data) {
	   				var theater = JSON.parse(data.responseText);
	   				
	   				if (theater == null) {
	   					return;
	   				}

	   				$('#naziv-bioskopa').val(theater.name)
	   				$('#adresa-bioskopa').val(theater.address)
	   				$('#desc-bioskopa').html(theater.description)
		   			theater.type == 'MOVIE_THEATER' ? $("#movie-theater-radio").attr('checked', 'checked') : $("#play-theater-radio").attr('checked', 'checked');
	   			
	   			
		   			showAllProjections();
	   			
	   			}
			});
			
			popuniIzborProjekcijaUModalu();
			popuniIzborSalaUModalu();
	   				
		})
	</script>
	<script>
		function updateTheater() {
			var theater_id = getUrlParameter('id');
		
			if (theater_id == "") {
				return;
			}
			
			var theater = getFormData($('#update-form'));
			var theaterJSON = JSON.stringify(theater);
			$.ajax({
	   			url: "update_theater/" + theater_id,
	   			type: "POST",
	   			data: theaterJSON,
				contentType:"application/json",
	   			dataType:"json",
	   			complete: function(data) {
	   				var s = JSON.parse(data.responseText);
	   				
	   				if (s == null || s == 'false') {
	   					alert('Greska!');
	   				} else {
	   					alert('Azurirane informacije!');
	   				}
				}
			});
		}
	</script>
	
	
	<style>
	
		/*header u vrhu stranice*/
		.top-header {
            background: white;
            min-height: 40px;
            margin: 20px 30px -5px 30px;
            padding: 5px 10px;
            
		}
		
		.top-header .title {
			color : #555;
            font-size: 27px;
		}
		
		/*centralni sadrzaj stranice*/
		.content {
			padding : 10px;
			margin: 30px 15px 150px 15px;
		}
		
		.blok {
			height: 500px;
			padding-bottom: 50px;
		}
		
		.header {
			background : #A16073;
			color : white;
			padding : 5px;
		}
		
		.flat-button {
			border: 0;
			background: #A16073;
			color: white;
			padding: 10px 15px;
			box-shadow: none;
			border-radius: 0px;
			-webkit-appearance: none;
			transition: background 0.1s linear;
		}
		.flat-button:HOVER {
			background: #c18093;
		}
		
	</style>
					
</head>
<body style='background:#e1f7d5;'>
	<div class='top-header'>
		<span style='color:#ccc;font-size:18px;'>&lt;&lt;&nbsp;</span><a href='/' class='title'>Bioskopi i pozorista</a>
	</div>
	
	<div class='content'>
		<div style='padding-bottom:20px; max-width: 480px;'>
			<div class='header'>Osnovni podaci</div>
			<form id='update-form' action='' style='background:white; padding:10px;'>
				<span style='display:inline-block;width:20%;margin:5px;'>Naziv: </span><input style='width:75%;' name='name' type='text' id='naziv-bioskopa'><br>
				<span style='display:inline-block;width:20%;margin:5px;'>Adresa: </span><input style='width:75%;' name='address' type='text' id='adresa-bioskopa'><br>
				<span style='display:inline-block;width:20%;margin:5px;'>Tip: </span><input type="radio" name="theaterType" value="MOVIE_THEATER" id='movie-theater-radio'> Bioskop<br>
  				<span style='display:inline-block;width:20%;margin:5px;'></span><input type="radio" name="theaterType" value="PLAY_THEATER" id='play-theater-radio'> Pozoriste<br>
				<span style='display:inline-block;width:20%;margin:5px;'>Opis: </span><textarea name='description' rows="4" style='resize:none;width:75%' id='desc-bioskopa'></textarea><br>
				<div style='text-align: right; margin:5px;'><input class='flat-button' type='button' onclick="updateTheater()" value='Azuriraj podatke'></div>
			</form>
		</div>
	
		<div class='row' >
			<div class='col-sm-12 blok'>
				<div class='header'>Repertoar</div>
				<ul id='repertoar' class='repertoar-ul' style='list-style: none; margin-bottom:0px; padding-left:0px;'>
						
	
						
				</ul>
				<div style='text-align: right; background:white;'>
					<button class='flat-button'  data-toggle='modal' data-target='#dodaj-termin-projekcije-modal' style='margin:5px;'>Dodaj termin projekcije</button><br>
					<div style='width: 100%; border-bottom: #c18093 solid 1px;'></div>
				</div>
				<div style='text-align:right; padding: 5px;'>
					<button class='flat-button'  data-toggle='modal' data-target='#dodaj-projekciju-modal'>Dodaj projekciju</button>
				</div>
			</div>
		</div>
		
	</div>
	
	<div id="dodaj-projekciju-modal" class="modal fade" role="dialog">
	  <div class="modal-dialog" >
	
	    <!-- Modal content-->
	    <div class="modal-content" style='border-radius:0px; border:0px;'>
	      <div class="modal-header header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">Dodaj projekciju</h4>
	      </div>
		      <div class="modal-body">
	        <form id='nova-projekcija-forma'>
		        	<span style='display:inline-block;width:100px;'>Naziv</span><input type='text' name='title' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Zanr</span><input type='text' name='genre' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Reziser</span><input type='text' name='director' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Trajanje</span><input type="number" name='runtime' style='margin-bottom: 5px;'><br>
		        	<span style='margin-bottom: 5px;'><span style='display:inline-block;width:100px;'>Opis</span><textarea name='description' style='resize:none;' rows='5' cols='50'></textarea></span><br>
		        	<span style='margin-bottom: 5px;'><span style='display:inline-block;width:100px;'>Glumci</span><textarea name='actors' style='resize:none;' rows='3' cols='50'></textarea></span><br>
		     
        	</form>
        	 </div>
	      
		      <div class="modal-footer">
<!-- 		        <input type="submit" class="flat-button" data-dismiss="modal" value='Dodaj'> -->
					<button class="flat-button" onclick='dodajProjekciju()'>Dodaj</button>
		      </div>
	    </div>
	
	  </div>
	</div>
	
	
	<div id="dodaj-termin-projekcije-modal" class="modal fade" role="dialog">
	  <div class="modal-dialog" >
	
	    <!-- Modal content-->
	    <div class="modal-content" style='border-radius:0px; border:0px;'>
	      <div class="modal-header header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">Dodaj termin projekcije</h4>
	      </div>
		      <div class="modal-body">
	        <form id='novi-termin-forma'>
		        	<span style='display:inline-block;width:100px;'>Projekcija</span><select id='projekcije-select' name='projection_id' style='margin-bottom: 5px;'></select><br>
		        	<span style='display:inline-block;width:100px;'>Datum</span><input type="date" name='date' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Vreme</span><input type="time" name='time' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Cena</span><input type="number" name='price' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Popust</span><input type="number" name='discount' style='margin-bottom: 5px;'><br>
		        	<span style='display:inline-block;width:100px;'>Sala</span><select id='sale-select' name='hall_label' style='margin-bottom: 5px;'></select><br>
		     
        	</form>
        	 </div>
	      
		      <div class="modal-footer">
<!-- 		        <input type="submit" class="flat-button" data-dismiss="modal" value='Dodaj'> -->
					<button class="flat-button" onclick='dodajTerminProjekcije()'>Dodaj termin</button>
		      </div>
	    </div>
	
	  </div>
	</div>
	
</body>
</html>