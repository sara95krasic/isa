<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Bioskopi - Profil korisnika - Moji prijatelji</title>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="js/helpers.js"></script>
	
	<script>
		function loadFrindsReq(){
			var logedUserId = window.currentUser.id;
			$.ajax({
				 url: "public/getRequests/" + window.currentUser.id,
				 method: "GET",
				 success: function(data){
					 $("#zahtevi").empty();
					// var users = JSON.parse(data.responseText);
					var users = data;
					 users.forEach(function (u, i) {
						 if(u.id != logedUserId){
							 $('#zahtevi').append( '<div style="margin-top:10px;">'+
								'<tr >'+
				                     '<td >'+
			                      		'<span class="font-weight-bold">' + u.name  +" "+ u.surname+ " "+ u.email +'</span>'+
			                      		'<span style="float:right;"><button class="zahBut"  onclick="prihvati(' + u.id +')"><img src="images/acept.png" title="prihvati prijateljstvo"></img></button></span>'+
		                                '<span style="float:right;"><button class="zahBut" onclick="odbij(' + u.id +')"><img src="images/decine.png" title="odbij prijateljstvo"></img></button></span>'+
			                         '</td>'+
			                   	'</tr>'+
			                   	'</div>'
		                	);
						}
			 		});
			 	},
				 error: function(){
					 alert("Greska pri ucitavanju zahteva za prijateljstvo!");
				 }
			});
		}
		
		function prihvati(id){
			$.ajax({
				 url: "public/acceptFriendReq/"+id,
				 method: "GET",
				 success: function(){					 
					 	 loadFrindsReq();
						 loadMyFriends();
						 alert("Prihvatili ste zahtev!")
				 },
				 error: function(){
					 alert("Greska pri prihvatanju prijateljstva!");
				 }
			});
		}
		
		function odbij(id){
			$.ajax({
				 url: "public/refuseRequest/"+id,
				 method: "GET",
				 success: function(){
					 loadFrindsReq();
					 alert('Odbili ste zahtev!');
				 },
				 error: function(){
					 alert("Greska");
				 }
			});
		}
		
		function loadMyFriends(){
			var logedUserId = window.currentUser.id;
			$.ajax({
				 url: "public/getFriends/" + window.currentUser.id,
				 method: "GET",
				 success: function(data){
					 $('#prijatelji').empty();
					 var users = data;
					 users.forEach(function (u, i) {
						 if(u.id != logedUserId){
							 $('#prijatelji').append( '<div style="margin-top:10px;">'+
								'<tr >'+
				                     '<td >'+
			                      		'<span class="font-weight-bold">' + u.name  +" "+ u.surname+ " "+ u.email +'</span>'+
			                      		 '<span class="float-right"><button class="zahBut" onclick="removeFr(' + u.id + ')"><img src="images/delete.png" title="remove from friends"></img></button></span>'+
			                         '</td>'+
			                   	'</tr>'+
			                   	'</div>'
								);
							}
				 		});
				 },
				 error: function(){
					 alert("Greska prilikom ucitavanja prijatelja!");
				 }
			});
		}
		
		function removeFr(id){
			$.ajax({
				 url: "public/removeFr/"+id,
				 method: "GET",
				 success: function(){
					 alert("Prijatelj obrisan!");
					 loadMyFriends();
				 },
				 error: function(){
					 alert("Greska prelikom brisanja!");
				 }
			});
		}
	
	</script>
	
	<script>
		$(document).ready(function(){
			
			$.ajax({
				url: "public/get_current_user",
				type:"GET",
				dataType:"json",
				complete: function(data) {
					
					//pripremi trenutno ulogovanog usera, da bude dostupan svima na stranici
					var user;
					if (data.responseText == "")
						//nista, nije ulogovan
						user = null;
					else
						user = JSON.parse(data.responseText);
					
					window.currentUser = user;	//cuvamo ga globalno, da ove funckcije sto treba da prikazu sve bioskope
												//mogu malo da koriguju prikaz za ulogovane korisnike
					//to je to
					loadFrindsReq();
					loadMyFriends();
					
				}	
			});
			
		})
	</script>
	
	<script>	
		function traziPrijateljaIme(){
			var user = {}
			user.name = $('#korisnici-search-box-ime').val();
			user.surname = $('#korisnici-search-box-surname').val();
			var userJson = JSON.stringify(user);
			var logedUserId = window.currentUser.id;
			$.ajax({
	   			url: "public/search_user_by_name_or_surname",
	   			type:"POST",
				contentType : 'application/json',
				dataType : "json",
				data: userJson,
				success: function(data){
					 $("#korisnici").empty();
					 var users = data;
					 users.forEach(function (u, i) {
						 if(u.id != logedUserId){
							 $('#korisnici').append('<div style="margin-top:10px;">'+
								'<tr>'+
				                     '<td style="margin-top:20px;">'+
			                      		'<span class="font-weight-bold">' + u.name  +" "+ u.surname+ " "+ u.email +'</span>'+
			                        	'<span class="float-right" style="float:right;"><a href="#"><img src="images/add.png" onclick="sendFriendRequest('+u.id +')" title="posalji zahtev za prijateljstvo"></img></a></span>'+
			                         '</td>'+
			                   	'</tr>'+
			                   	'</div>'
		                	);
							
						}
			 		});
			 	},
			 	error : function(){
			 		 $('#korisnici').html(
			 				'<li style="font-style:italic;color:grey; margin-top:10px;">Nema rezulata</li>'		 
			 		 );
			 	}
			});
	   		
		}
		
		function sendFriendRequest(receiverid){
		
			$.ajax({
				 url: "public/sendReq/"+receiverid,
				 method: "GET",
				 success: function(){
					 alert("Uspesno poslat zahtev!");
									 
				 },
				 error: function(){
					 alert("Greska pri slanju zahteva!");
				 }
			});
		}
		
	</script>
	
	
	
	
	<style>
	
		/*header u vrhu stranice*/
		.top-header {
            background: white;
            min-height: 40px;
            margin: 20px 30px -5px 30px;
            padding: 5px 10px;
            
		}
		
		.top-header .title {
			color : #555;
            font-size: 27px;
           
		}
		
		/*centralni sadrzaj stranice*/
		.content {
			margin-left: 15px;
			margin-top: 10px;
		}
		
		.blok {
			padding-bottom: 50px;
			
			
		}
		
		.header {
			background : #A16073;
			color : white;
			padding : 5px;	
		}
		
		.flat-button {
			border: 0;
			background: #A16073;
			color: white;
			padding: 3px 10px;
			box-shadow: none;
			border-radius: 0px;
			-webkit-appearance: none;
			transition: background 0.1s linear;
		}
		
		
		
		.flat-button:HOVER {
			background: #c18093;
		}
		
		.flat-buttonn {	
			border: 0;
			color: white;
			padding: 3px 10px;
			background: #A16073;
			display: inline-block;
  			text-decoration: none;
  			-webkit-appearance: none;
  			transition: background 0.1s linear;
		}
		
		.pronadjiText {
			color: #A16073;
			font-size: 16px;
		}
		
		.flat-buttonn:HOVER {
			background: #c18093;
			color: white;
			text-decoration: none;
		}
		
		.trazi {
			width: 60%;
			font-style: italic;
			color: grey;
		}
		
		.trazi:HOVER {
			background:#E5FAE1;
		}
		
		.zahBut {
			background:white;
			border:0px;
			padding: 0px 4px;
		}
		
	</style>
					
</head>
<body  style='background:#e1f7d5;'>
	<div class='top-header'>
		<span style='color:#ccc;font-size:18px;'>&lt;&lt;&nbsp;</span><a href='/' class='title'>Bioskopi i pozorista</a>
	</div>
	
	<div class='content'>
		<div class='col-sm-6 blok'>
			<div class='header'>
				<div>Profil korisnika - moji prijatelji</div>
			</div>
			
			
			
			<div style='background: white; padding: 10px 15px;'>
				
				<div>
					<label class='pronadjiText' >Pristigli zahtevi:</label><br>
					<table id='zahtevi' style='margin-top:0px;'>
					 	<!--<td>
	                	  	<span class="font-weight-bold">+data[i].name+  +data[i].surname+ | +data[i].email+ | +data[i].city+ | +data[i].phone+</span>
	                    	 <span class="float-right"><button class="zahBut"><img src="images/acept.png" title="prihvati prijateljstvo"></img></button></span>
                                   <span class="float-right"><button class="zahBut"><img src="images/decine.png" title="odbij prijateljstvo"></img></button></span>
	               		</td> -->
					</table>
				</div>
			
				<div id='korisnik' style='margin-top:10px;' >
					<label class='pronadjiText' >Lista prijatelja:</label><br>
					<table id='prijatelji'>
						<!-- <tr>
                           <td>
                              <span class="font-weight-bold">`+data[i].name+` +` | `+data[i].phone+`</span>
                              <span class="float-right"><a href="#"><img onclick="removeFriend(`+data[i].id+`)" src="images/delete.png" title="remove from friends"></img></a></span>
                           </td>
                       </tr>-->
					</table>
				</div>
				
				<div style='padding:5px;text-align:left;'>
					<label class='pronadjiText' >Pronadji prijatelje:</label><br>
					<input id='korisnici-search-box-ime' class="trazi" type='text' placeholder="Ime trazenog korisnika..." oninput="traziPrijateljaIme()"><br>
					<input style='margin-top:10px;' id='korisnici-search-box-surname' class="trazi" type='text' placeholder="Prezime trazenog korisnika..." oninput="traziPrijateljaIme()"><br>
					<div>
						<table id='korisnici' style='margin-top:10px;'>
                        	<!--<tr>
	                        	 <td>
	                            	<span class="font-weight-bold">+data[i].name+  +data[i].surname+ | +data[i].email+ | +data[i].city+ | +data[i].phone+</span>
	                            	<span class="float-right"><a href="#"><img src="images/add.png" onclick="sendFriendRequest(`+data[i].id+`)" title="send friend request"></img></a></span>
	                         	</td>
	                     	</tr>-->
                    	</table>
	                     
					
					</div>
				</div>
					
				
				
			</div>
		</div>
	</div>
	
</body>
</html>